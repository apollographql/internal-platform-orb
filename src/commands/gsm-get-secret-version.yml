description: Retrieve the specified secret version from Google Secret Manager (GSM) and stores it in the provided file in the current executor. Expects the gcloud cli to be available and to have already authenticated to a GCP project that contains the requested secret.
parameters:
  gsm-secret-name:
    type: string
    description: The name of the secret in Google Secret Manager to retrieve.
  gsm-secret-version:
    type: string
    default: latest
    description: The version (or version alias) of the secret to retrieve.
  file:
    type: string
    default: /tmp/gsm-secret.txt
    description: The full path to the file to which the secret should be written.

steps:
  - run:
      name: Set Envvars via secret(s)
      command: |
          VALUE=$(gcloud secrets versions access << parameters.gsm-secret-version >>\
           --secret=<< parameters.gsm-secret-name >> --project=${GCP_PROJECT_ID})
          echo "${VALUE}" >> "<< parameters.file >>"
